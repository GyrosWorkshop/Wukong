FROM microsoft/dotnet:1.1.1-sdk
WORKDIR /dotnetapp

RUN mkdir -p /dotnetapp
COPY Wukong.sln .
COPY Wukong ./Wukong
COPY Wukong.Tests ./Wukong.Tests

RUN dotnet restore
# Publish linux version.
RUN dotnet publish -c Release -o ../wukong-dist_linux-x64 -r debian.8-x64
RUN tar czvf wukong-dist_linux-x64.tar.gz wukong-dist_linux-x64/

EXPOSE 5000
CMD ["./wukong-dist_linux-x64/Wukong"]
